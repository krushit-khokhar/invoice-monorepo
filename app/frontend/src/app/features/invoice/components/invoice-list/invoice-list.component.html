<div class="invoice-list-container">
  <div class="header">
    <h2>Invoice Management</h2>
    <button mat-raised-button color="primary" (click)="createInvoice()">
      <mat-icon>add</mat-icon> Create Invoice
    </button>
  </div>

  <!-- Search Component -->
  <app-invoice-search
    (searchChange)="onSearchParamsChange($event)">
  </app-invoice-search>

  <div class="table-container">
    <div class="loading-overlay" *ngIf="isLoading">
      <app-loading-spinner></app-loading-spinner>
    </div>

    <!-- Results Summary -->
    <div class="results-summary" *ngIf="!isLoading">
      <p *ngIf="totalItems > 0">
        Showing {{ dataSource?.data?.length }} of {{ totalItems }} invoices
        <span *ngIf="hasActiveFilters()" class="filter-indicator">(filtered)</span>
      </p>
      <p *ngIf="totalItems === 0 && !hasActiveFilters()">
        No invoices found. <a routerLink="/invoices/create">Create your first invoice</a>
      </p>
      <p *ngIf="totalItems === 0 && hasActiveFilters()">
        No invoices match your search criteria. <a (click)="onSearchParamsChange({})">Clear filters</a>
      </p>
    </div>
    

    <table mat-table [dataSource]="dataSource" matSort (matSortChange)="onSortChange($event)" class="mat-elevation-z2">
      <!-- Invoice Number Column -->
      <ng-container matColumnDef="invoice_number">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Invoice Number</th>
        <td mat-cell *matCellDef="let invoice">{{ invoice?.invoice_number }}</td>
      </ng-container>

      <!-- Invoice Date Column -->
      <ng-container matColumnDef="invoice_date">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Date</th>
        <td mat-cell *matCellDef="let invoice">{{ invoice?.invoice_date | dateFormat }}</td>
      </ng-container>

      <!-- From Name Column -->
      <ng-container matColumnDef="from_name">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>From</th>
        <td mat-cell *matCellDef="let invoice">{{ invoice?.from_name }}</td>
      </ng-container>

      <!-- To Name Column -->
      <ng-container matColumnDef="to_name">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>To</th>
        <td mat-cell *matCellDef="let invoice">{{ invoice?.to_name }}</td>
      </ng-container>

      <!-- Total Amount Column -->
      <ng-container matColumnDef="total_amount">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Total Amount</th>
        <td mat-cell *matCellDef="let invoice">{{ invoice?.total_amount | currencyFormat }}</td>
      </ng-container>

      <!-- Actions Column -->
      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef>Actions</th>
        <td mat-cell *matCellDef="let invoice">
          <button mat-icon-button color="primary" (click)="viewInvoice(invoice)" title="View Invoice">
            <mat-icon>visibility</mat-icon>
          </button>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
    </table>

    <mat-paginator 
      [length]="totalItems"
      [pageSize]="pageSize"
      [pageIndex]="currentPage"
      [pageSizeOptions]="[5, 10, 25, 50]"
      (page)="onPageChange($event)"
      showFirstLastButtons
      aria-label="Select page of invoices">
    </mat-paginator>
  </div>
</div>